---
title: "Case Study: How Does a Bike-Share Navigate Speedy Success?"
author: "Laura Fontanills"
date: "`r format(Sys.time(), '%d %B %Y')`"
mail: "lfontanills@gmail.com"
linkedin: "lfontanills"
github: "lfontanills"
home: "lfontanills.github.io"
# !!! You need to provide a logo image here !!! Or just delete the field for no logo
# logo: "logo_gallery.png"
output:
  epuRate::epurate:
    toc: TRUE
    number_sections: FALSE
    code_folding: "hide"
---

```{r load libraries, message=FALSE, warning=FALSE}
library(tidyverse) # data processing and analysis
library(lubridate) # wrangle dates and times
library(kableExtra) # generate data tables
library(rmarkdown) # You need this library to run this template.
library(epuRate)  # Install with devtools: install_github("holtzy/epuRate", force=TRUE)
options(dplyr.summarise.inform = FALSE)
```


# About
***

I completed this case study as the capstone project for the Google Data Analytics Certification course. I used base R and tidyverse to complete my analysis and create visualizations.


## Project Objective
***

The case study is about a fictional bike-share company called Cyclistic, and my task was to evaluate how members and non-members ("casual") use the bike-share differently. I analyzed the number of rides taken in different time periods, the duration of rides, and the types of bikes used. 

The data is taken from a real bike-share -- Chicago-based Divvy -- so in this report I will describe some considerations and assumptions I made to reconcile the case study and the real data set.

```{r comparison_table}

comparison_table <- tibble(
  Item = c("Member types", "Bike types", "Docking", "Pricing"),
  Cyclistic = c("Member, Casual", "Classic, E-bike, Accessible bikes", "Must be docked", "Unspecified"),
  Divvy = c("Member, Casual", "Classic, E-Bike, Docked bike", "Docked, undocked with fees", "Flat rates with fees")
)

comparison_table %>% 
  kbl() %>% 
  kable_material(c("striped"))
```

* **Bike types**: Since Cyclistic's accessible bikes account for 8% of riders, and Divvy does not have accessible bikes, I consider only classic and e-bikes in my analysis. The presence of a nonspecific "docked" bike type in the Divvy dataset limited my analysis.
* **Docking**: Divvy docks use a different geolocation system than the bikes themselves-- docks have geolocation with 0.000001° sensitivity, while undocked bikes have geolocation with 0.01° sensitivity. Many Divvy docks are within 0.01° of other docks, especially in the city center where most rides take place, so undocked bikes can't reliably be matched with nearby docks. As Cyclistic bikes must all be docked, I am considering only bikes that start and end at docks in my analysis.
* **Other**: Divvy's ride timestamps don't adjust for Daylight Savings Time (which began March 13th 2022, and ended November 6th 2022).

# Get the data
***

[Click here](https://divvy-tripdata.s3.amazonaws.com/index.html) to view historical Divvy data. Each month's data is contained in a single .csv file. I looked at data for the previous 12 months (January 2022 to December 2022).

Before working in R, I reviewed each month's data independently in Excel, to get a better sense of the data. I discovered the following inconsistencies that I would need to address.
* Test rides outside the Chicago area or with no geolocation
* Rides starting before and ending after the DST time changes in March and November
* Many rides shorter than 1 minute, which could be due to bike problems
* Many rides longer than 24 hours, which could be due to docking problems
* Rides with no end location
* A nonspecific "docked" bike type associated with a small percentage of rides by casual users

I combined the 12 months of Divvy data into a single data frame.
```{r read combined df}
rides_2022 <- read.csv("rides_2022.csv")
head(rides_2022)
```

This file has `r nrow(df)` lines and `r ncol(df)` columns. 

## Data cleaning
***

This file has `r nrow(df)` lines and `r ncol(df)` columns. It is ready to be analyzed.


## Analysis and Visualizations

## Finding 1: Casual riders take more weekend trips
Member rides peak during the work week, which could indicate that many members use bikes for commuting. Casual rides peak on Saturday and Sunday, suggesting that casual riders use bikes for leisure or tourism.
```{r fig.align='center', warning=FALSE}
weekday_plot <-
  rides_all_clean %>% 
  mutate(weekday = wday(started_at, label = TRUE, abbr = FALSE)) %>% 
  group_by(member_casual, weekday) %>% 
  summarize(count=n()) %>% 
  ggplot(aes(x=weekday, y=count, fill=member_casual))+
  geom_col(position="dodge") +
  labs(
    title = "Number of rides by weekday",
    subtitle = "For all trips between 1 minute and 24 hours long",
    x = "User type", 
    y = "Number of rides",
    fill = "User type") +
  scale_y_continuous(labels = scales::comma) +
  theme_bw() + 
  scale_fill_brewer(palette = "Greens", direction = -1)

weekday_plot
```

## Finding 2: Casual riders take longer trips than members

Member rides, on average, take about 12 minutes, while casual rides last more than 20 minutes. Taken with finding 1, this indicates that many casual users are riding for fun.
```{r, warning=FALSE, fig.align='center' }
length_plot <-
rides_all_clean %>% 
  group_by(member_casual) %>% 
  summarize(number_of_rides = n(), mean_length = mean(ride_length)) %>% 
  arrange(member_casual) %>% 
  ggplot(aes(x=member_casual, y=mean_length, fill=member_casual)) +
  geom_col(position = "dodge") +
  labs(
    title = "Average ride duration",
    subtitle = "For all trips between 1 minute and 24 hours long",
    x = "User type", 
    y = "Average ride duration (seconds)",
    fill = "User type") +
  scale_x_discrete(labels = c("classic bike", "electric bike")) +
  scale_y_continuous(labels = scales::comma) +
  theme_bw() + 
  scale_fill_brewer(palette = "Greens", direction = -1)

length_plot
```

## Finding 3: Casual riders use a few stations relatively frequently

Casual riders show a clear preference for 5 stations in particular -- these stations make up about 8% of all casual rides (by starting point). Members don't especially favor a few stations, and no station accounts for more than 1% of all member rides (by starting point).
```{r, warning=FALSE, fig.align='center' }
rides_all_clean %>% 
  filter(member_casual == "casual") %>% 
  group_by(member_casual, start_station_name) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  mutate(percent_of_rides = 100*(count/sum(count))) %>% 
  head(10)

rides_all_clean %>% 
  filter(member_casual == "member") %>% 
  group_by(member_casual, start_station_name) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  mutate(percent_of_rides = 100*(count/sum(count))) %>% 
  head(10)
```
The top 5 casual starting stations are located in parks in the city center, close to the waterfront. These are very popular locations for tourists and locals.

# Conclusion
***
Casual riders and members differ in when they ride bikes, and how long they ride for. Casual riders also favor a few stations in the city center.

Here are my recommendations for converting casual riders to members:
* Market to non-commuter casual riders who use bikes for leisure
* Consider new membership options and pricing (e.g. weekend passes, adjusted pricing for longer trips)
* Increase advertising at high-traffic stations in the city center

## Resources
***
[Data source](https://divvy-tripdata.s3.amazonaws.com/index.html)

[Data license](https://ride.divvybikes.com/data-license-agreement)

[City of Chicago Divvy database](https://data.cityofchicago.org/Transportation/Divvy-Bicycle-Stations-All-Map/bk89-9dk7)

<!-- Read more about this template [here](https://github.com/holtzy/epuRate). -->

<!-- Learn how to custom your R Markdown document [here](https://holtzy.github.io/Pimp-my-rmd/). -->
